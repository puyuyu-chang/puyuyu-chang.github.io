<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¥ºãƒã‚¦ãƒ³ãƒ‰ï¼ˆã‚¯ãƒªãƒƒã‚¯å¼·åŒ–ä»˜ãï¼‰</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100vh;
      margin: 0;
      background: #ffffdd;
    }
    canvas {
      border: 6px solid black;
      margin-top: 40px;
      image-rendering: auto;
    }
  </style>
</head>
<body>
  <canvas id="game" width="450" height="450"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    // ğŸ¥ºé–¢é€£
    const emoji = "ğŸ¥º";
    const fontSize = 90;
    const emojiRadius = fontSize / 2;
    let x = canvas.width / 2;
    let y = canvas.height / 2;
    let dx = 0;
    let dy = 0;
    let lastAngle = null;

    // ã‚¹ã‚³ã‚¢ & å¼·åŒ–
    let puyuyu = 0;
    let clickValue = 1;
    let upgradeLevel = 1;
    let upgradeCost = 50;
    
    let wallLevel = 1;        // å£ã‚¿ãƒƒãƒå¼·åŒ–ãƒ¬ãƒ™ãƒ«
let wallCost = 100;       // åˆæœŸã‚³ã‚¹ãƒˆ
let wallValue = 0;        // å£ã«è·³ã­è¿”ã£ãŸã¨ãã«ç²å¾—ã™ã‚‹puyuyu


    // å¼·åŒ–ãƒœã‚¿ãƒ³è¡¨ç¤ºä½ç½®ãƒ»ã‚µã‚¤ã‚º
    const labelFontSize = 22;
    const labelX = canvas.width - 200;
    const labelY = canvas.height - 40;
    let labelWidth = 0;
    const labelHeight = labelFontSize;

    // ãƒ©ãƒ³ãƒ€ãƒ æ–¹å‘ç”Ÿæˆï¼ˆå‰å›ã¨ã‚ã¾ã‚Šè¿‘ããªã‚‰ã‚„ã‚Šç›´ã—ï¼‰
    function newDirection() {
      let angle;
      do {
        angle = Math.random() * 2 * Math.PI;
      } while (
        lastAngle !== null &&
        Math.abs(Math.atan2(Math.sin(angle - lastAngle), Math.cos(angle - lastAngle))) < (Math.PI / 3)
      );
      lastAngle = angle;
      return angle;
    }

    // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¸­å¤®ğŸ¥ºã¨å¼·åŒ–ãƒœã‚¿ãƒ³ï¼‰
    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const clickX = (e.clientX - rect.left) * scaleX;
      const clickY = (e.clientY - rect.top) * scaleY;

      // å£ã‚¿ãƒƒãƒãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯åˆ¤å®š
if (
  clickX >= wallLabelX &&
  clickX <= wallLabelX + wallLabelWidth &&
  clickY >= wallLabelY &&
  clickY <= wallLabelY + labelHei
  
  
  
  ght
) {
  if (puyuyu >= wallCost) {
    puyuyu -= wallCost;
    wallLevel++;
    wallCost = Math.floor(wallCost + wallCost * 0.1);
    wallValue = Math.floor(wallValue + wallValue * 0.1) + 1; // ã‚¿ãƒƒãƒ—å¼·åŒ–ã¨åŒã˜è¨ˆç®—å¼
  }
}

      
      // ğŸ¥ºã‚¯ãƒªãƒƒã‚¯åˆ¤å®š
      if (
        clickX >= x - emojiRadius &&
        clickX <= x + emojiRadius &&
        clickY >= y - emojiRadius &&
        clickY <= y + emojiRadius
      ) {
        const angle = newDirection();
        const speed = 2.0;
        dx = Math.cos(angle) * speed;
        dy = Math.sin(angle) * speed;
        puyuyu += clickValue;
      }

      // å¼·åŒ–ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯åˆ¤å®š
      if (
        clickX >= labelX &&
        clickX <= labelX + labelWidth &&
        clickY >= labelY &&
        clickY <= labelY + labelHeight
      ) {
        if (puyuyu >= upgradeCost) {
          puyuyu -= upgradeCost;
          upgradeLevel++;
          upgradeCost = Math.floor(upgradeCost + upgradeCost * 0.1);
          clickValue = Math.floor(clickValue + clickValue * 0.1) + 1;
        }
      }
    });

    
    // æç”»ãƒ»æ›´æ–°ãƒ«ãƒ¼ãƒ—
    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ğŸ¥ºä½ç½®æ›´æ–°
      x += dx;
      y += dy;

// å£ãƒã‚¦ãƒ³ãƒ‰
if (x - emojiRadius <= 0 || x + emojiRadius >= canvas.width) {
  dx = -dx;
  x = Math.max(emojiRadius, Math.min(x, canvas.width - emojiRadius));
  puyuyu += wallValue;   // â†å£ãƒã‚¦ãƒ³ãƒ‰æ™‚ã«ãƒã‚¤ãƒ³ãƒˆåŠ ç®—
}
if (y - emojiRadius <= 0 || y + emojiRadius >= canvas.height) {
  dy = -dy;
  y = Math.max(emojiRadius, Math.min(y, canvas.height - emojiRadius));
  puyuyu += wallValue;
}

// å£ã‚¿ãƒƒãƒãƒœã‚¿ãƒ³æç”»ï¼ˆå³ä¸‹ã®ã‚¿ãƒƒãƒ—å¼·åŒ–ã®ä¸Šï¼‰
const wallLabelText = `å£ã‚¿ãƒƒãƒ(Lv${wallLevel}) ğŸ¥º${wallCost}`;
const wallLabelX = canvas.width - 200;
const wallLabelY = canvas.height - 80; // ã‚¿ãƒƒãƒ—å¼·åŒ–ã®ä¸Š

ctx.save();
ctx.font = `${labelFontSize}px sans-serif`;
ctx.textAlign = "left";
ctx.textBaseline = "top";
ctx.fillStyle = "#000";
ctx.globalAlpha = 0.7;
ctx.fillText(wallLabelText, wallLabelX, wallLabelY);
ctx.globalAlpha = 1.0;
wallLabelWidth = ctx.measureText(wallLabelText).width; // åˆ¤å®šç”¨
ctx.restore();

      
      // ğŸ¥ºæç”»
      ctx.save();
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.font = fontSize + "px serif";
      ctx.fillText(emoji, x, y);
      ctx.restore();

      // ã‚¹ã‚³ã‚¢è¡¨ç¤ºï¼ˆå·¦ä¸Šï¼‰
      ctx.save();
      ctx.font = "22px sans-serif";
      ctx.textAlign = "left";
      ctx.textBaseline = "top";
      ctx.fillText("ğŸ¥º " + puyuyu, 8, 8);
      ctx.restore();

      // å¼·åŒ–ãƒœã‚¿ãƒ³æç”»ï¼ˆå³ä¸‹ï¼‰
      const labelText = `ã‚¿ãƒƒãƒ—(Lv${upgradeLevel}) ğŸ¥º${upgradeCost}`;
      ctx.save();
      ctx.font = `${labelFontSize}px sans-serif`;
      ctx.textAlign = "left";
      ctx.textBaseline = "top";
      ctx.fillStyle = "#000";
      ctx.globalAlpha = 0.7;
      ctx.fillText(labelText, labelX, labelY);
      ctx.globalAlpha = 1.0;
      // å¹…ã‚’è¨ˆç®—ã—ã¦åˆ¤å®šã«ä½¿ã†
      labelWidth = ctx.measureText(labelText).width;
      ctx.restore();



      
      requestAnimationFrame(update);
    }

    update();
  </script>
</body>
</html>
