<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ü•∫„Éê„Ç¶„É≥„ÉâÔºà„ÇØ„É™„ÉÉ„ÇØÂº∑Âåñ‰ªò„ÅçÔºâ</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100vh;
      margin: 0;
      background: #ffffdd;
    }
    canvas {
      border: 6px solid black;
      margin-top: 40px;
      image-rendering: auto;
    }
  </style>
</head>
<body>
  <canvas id="game" width="450" height="450"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const emoji = "ü•∫";
    const fontSize = 90;
    const emojiRadius = fontSize / 2;

    let x = canvas.width / 2;
    let y = canvas.height / 2;
    let dx = 0;
    let dy = 0;
    let lastAngle = null;

    // „Çπ„Ç≥„Ç¢ & Âº∑ÂåñÈñ¢ÈÄ£
    let puyuyu = 0;
    let clickValue = 1;
    let upgradeLevel = 1;
    let upgradeCost = 50;

    function newDirection() {
      let angle;
      do {
        angle = Math.random() * 2 * Math.PI;
      } while (
        lastAngle !== null &&
        Math.abs(Math.atan2(Math.sin(angle - lastAngle), Math.cos(angle - lastAngle))) < (Math.PI / 3)
      );
      lastAngle = angle;
      return angle;
    }

    // ü•∫„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const clickX = (e.clientX - rect.left) * scaleX;
      const clickY = (e.clientY - rect.top) * scaleY;

      // ü•∫„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà
      if (
        clickX >= x - emojiRadius &&
        clickX <= x + emojiRadius &&
        clickY >= y - emojiRadius &&
        clickY <= y + emojiRadius
      ) {
        const angle = newDirection();
        const speed = 2.0;
        dx = Math.cos(angle) * speed;
        dy = Math.sin(angle) * speed;
        puyuyu += clickValue;
      }

      // Âº∑Âåñ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà
      const buttonWidth = 160;
      const buttonHeight = 40;
      const buttonX = canvas.width - buttonWidth - 10;
      const buttonY = canvas.height - buttonHeight - 10;
if (clickX >= buttonX && clickX <= buttonX + buttonWidth &&
    clickY >= buttonY && clickY <= buttonY + buttonHeight) {
  if (puyuyu >= upgradeCost) {
    puyuyu -= upgradeCost;
    upgradeLevel++;
    upgradeCost = Math.floor(upgradeCost + upgradeCost * 0.1);
    clickValue = Math.floor(clickValue + clickValue * 0.1) + 1; // ‚Üê „Åì„Åì„Åå‰øÆÊ≠£ÁÇπ
  }
}

    });

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ü•∫„ÅÆ‰ΩçÁΩÆÊõ¥Êñ∞
      x += dx;
      y += dy;

      // Â£Å„Éê„Ç¶„É≥„Éâ
      if (x - emojiRadius <= 0 || x + emojiRadius >= canvas.width) {
        dx = -dx;
        x = Math.max(emojiRadius, Math.min(x, canvas.width - emojiRadius));
      }
      if (y - emojiRadius <= 0 || y + emojiRadius >= canvas.height) {
        dy = -dy;
        y = Math.max(emojiRadius, Math.min(y, canvas.height - emojiRadius));
      }

      // ü•∫ÊèèÁîª
      ctx.save();
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.font = fontSize + "px serif";
      ctx.fillText(emoji, x, y);
      ctx.restore();

      // „Çπ„Ç≥„Ç¢Ë°®Á§∫
      ctx.save();
      ctx.textAlign = "left";
      ctx.textBaseline = "top";
      ctx.font = "22px sans-serif";
      ctx.fillText("ü•∫ " + puyuyu, 8, 8);
      ctx.restore();

      // Âº∑Âåñ„Éú„Çø„É≥ÊèèÁîª
// Âº∑Âåñ„É©„Éô„É´„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Å®„Çπ„Çø„Ç§„É´
const labelText = `„Çø„ÉÉ„Éó(Lv${upgradeLevel}) ü•∫${upgradeCost}`;
const labelFontSize = 22;
ctx.save();
ctx.font = `${labelFontSize}px sans-serif`;
ctx.textAlign = "left";
ctx.textBaseline = "top";
ctx.globalAlpha = 0.6;
ctx.fillStyle = "#000";

// Ë°®Á§∫‰ΩçÁΩÆÔºàÂè≥‰∏ãÂØÑ„ÇäÔºâ
const labelX = canvas.width - 200;
const labelY = canvas.height - 40;

// ÊèèÁîª
ctx.fillText(labelText, labelX, labelY);

// ‰∏ÄÊôÇÁöÑ„Å™Ëµ§Êû†ÔºàÂΩì„Åü„ÇäÂà§ÂÆö„ÅÆÁ¢∫Ë™çÁî®Ôºâ
const metrics = ctx.measureText(labelText);
const textWidth = metrics.width;
const textHeight = labelFontSize; // È´ò„Åï„ÅØ„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÅßËøë‰ºº
ctx.globalAlpha = 1.0;
ctx.strokeStyle = "red";
ctx.lineWidth = 1;
ctx.strokeRect(labelX, labelY, textWidth, textHeight);

ctx.restore();

// ü•∫„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà + Âº∑Âåñ„Éú„Çø„É≥Âà§ÂÆö
canvas.addEventListener("click", (e) => {
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;
  const clickX = (e.clientX - rect.left) * scaleX;
  const clickY = (e.clientY - rect.top) * scaleY;

  // ü•∫„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà
  if (
    clickX >= x - emojiRadius &&
    clickX <= x + emojiRadius &&
    clickY >= y - emojiRadius &&
    clickY <= y + emojiRadius
  ) {
    const angle = newDirection();
    const speed = 2.0;
    dx = Math.cos(angle) * speed;
    dy = Math.sin(angle) * speed;
    puyuyu += clickValue;
  }

  // Âº∑Âåñ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà
  const labelFontSize = 22;
  const labelX = canvas.width - 200;
  const labelY = canvas.height - 40;
  const metrics = ctx.measureText(`„Çø„ÉÉ„Éó(Lv${upgradeLevel}) ü•∫${upgradeCost}`);
  const textWidth = metrics.width;
  const textHeight = labelFontSize;

  if (
    clickX >= labelX &&
    clickX <= labelX + textWidth &&
    clickY >= labelY &&
    clickY <= labelY + textHeight
  ) {
    if (puyuyu >= upgradeCost) {
      puyuyu -= upgradeCost;
      upgradeLevel++;
      upgradeCost = Math.floor(upgradeCost + upgradeCost * 0.1);
      clickValue = Math.floor(clickValue + clickValue * 0.1) + 1;
    }
  }
});



      requestAnimationFrame(update);
    }

    update();
  </script>
</body>
</html>
