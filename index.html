<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¥ºãƒã‚¦ãƒ³ãƒ‰æ”¹</title>
  <style>
    body {
      margin: 0;
      background: #fffbe6;
    }
    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
      border: 5px solid black;
      background: #ffffdd;
      overflow: hidden;
    }
    #emoji {
      position: absolute;
      font-size: 80px; /* å°‘ã—å¤§ãã */
      user-select: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="emoji">ğŸ¥º</div>
  </div>

  <script>
    const game = document.getElementById("game");
    const emoji = document.getElementById("emoji");

    let rect = emoji.getBoundingClientRect();
    let emojiSize = rect.width; // å®Ÿéš›ã®æç”»å¹…
    let gameWidth = game.clientWidth;
    let gameHeight = game.clientHeight;

    let x = (gameWidth - emojiSize) / 2;
    let y = (gameHeight - emojiSize) / 2;
    let dx = 0;
    let dy = 0;
    let lastAngle = null;

    // åˆæœŸé…ç½®
    emoji.style.left = x + "px";
    emoji.style.top = y + "px";

    // ãƒ©ãƒ³ãƒ€ãƒ è§’åº¦ç”Ÿæˆï¼ˆå‰å›ã¨ä¼¼ãªã„ï¼‰
    function newDirection() {
      let angle;
      do {
        angle = Math.random() * 2 * Math.PI;
      } while (
        lastAngle !== null &&
        Math.abs(Math.atan2(Math.sin(angle - lastAngle), Math.cos(angle - lastAngle))) < (Math.PI / 6) // 30åº¦ä»¥å†…ã¯ã‚„ã‚Šç›´ã—
      );
      lastAngle = angle;
      return angle;
    }

    // ã‚¯ãƒªãƒƒã‚¯ã§æ–¹å‘å¤‰æ›´
    emoji.addEventListener("click", () => {
      const angle = newDirection();
      const speed = 2.0; // é€Ÿåº¦ã‚’è½ã¨ã™
      dx = Math.cos(angle) * speed;
      dy = Math.sin(angle) * speed;
    });

    function update() {
      gameWidth = game.clientWidth;
      gameHeight = game.clientHeight;
      rect = emoji.getBoundingClientRect();
      emojiSize = rect.width;

      x += dx;
      y += dy;

      // å£åå°„
      if (x <= 0 || x + emojiSize >= gameWidth) {
        dx = -dx;
        x = Math.max(0, Math.min(x, gameWidth - emojiSize));
      }
      if (y <= 0 || y + emojiSize >= gameHeight) {
        dy = -dy;
        y = Math.max(0, Math.min(y, gameHeight - emojiSize));
      }

      emoji.style.left = x + "px";
      emoji.style.top = y + "px";

      requestAnimationFrame(update);
    }

    update();
  </script>
</body>
</html>
