<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã·ã‚†ã‚²ãƒ¼</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      background: #fffff0;
    }
    canvas {
      border: 6px solid black;
      background: #ffffe0;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="450" height="450"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const emoji = "ğŸ¥º";
    const fontSize = 48;
    const emojiRadius = fontSize / 2;

    // ä½ç½®ã¨é€Ÿåº¦
    let x = canvas.width / 2;
    let y = canvas.height / 2;
    let dx = 0;
    let dy = 0;
    let lastAngle = null;

    // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ç³»
    let puyuyu = 0;
    let clickPower = 1;   // ã‚¯ãƒªãƒƒã‚¯ç²å¾—æ•°
    let tapLevel = 1;     // ã‚¿ãƒƒãƒ—ãƒ¬ãƒ™ãƒ«
    let tapCost = 50;     // ã‚¿ãƒƒãƒ—ã®å€¤æ®µ

    function newDirection() {
      let angle;
      do {
        angle = Math.random() * 2 * Math.PI;
      } while (
        lastAngle !== null &&
        Math.abs(Math.atan2(Math.sin(angle - lastAngle), Math.cos(angle - lastAngle))) < (Math.PI / 3)
      );
      lastAngle = angle;
      return angle;
    }

    // ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const clickX = (e.clientX - rect.left) * scaleX;
      const clickY = (e.clientY - rect.top) * scaleY;

      // ğŸ¥ºã‚¯ãƒªãƒƒã‚¯åˆ¤å®š
      if (
        clickX >= x - emojiRadius &&
        clickX <= x + emojiRadius &&
        clickY >= y - emojiRadius &&
        clickY <= y + emojiRadius
      ) {
        const angle = newDirection();
        const speed = 2.0;
        dx = Math.cos(angle) * speed;
        dy = Math.sin(angle) * speed;
        puyuyu += clickPower;
      }

      // ã‚¿ãƒƒãƒ—è³¼å…¥åˆ¤å®šï¼ˆå³ä¸‹ã«é…ç½®ã—ãŸãƒœã‚¿ãƒ³é ˜åŸŸï¼‰
      const tapX = canvas.width - 150;
      const tapY = canvas.height - 40;
      const tapW = 140;
      const tapH = 30;

      if (
        clickX >= tapX &&
        clickX <= tapX + tapW &&
        clickY >= tapY &&
        clickY <= tapY + tapH
      ) {
        if (puyuyu >= tapCost) {
          puyuyu -= tapCost;
          tapLevel++;
          clickPower = Math.floor(1 + clickPower * 0.1);
          tapCost += Math.floor(tapCost * 0.1);
        }
      }
    });

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ç§»å‹•ã¨ãƒã‚¦ãƒ³ãƒ‰
      x += dx;
      y += dy;

      if (x - emojiRadius <= 0 || x + emojiRadius >= canvas.width) {
        dx = -dx;
        x = Math.max(emojiRadius, Math.min(x, canvas.width - emojiRadius));
      }
      if (y - emojiRadius <= 0 || y + emojiRadius >= canvas.height) {
        dy = -dy;
        y = Math.max(emojiRadius, Math.min(y, canvas.height - emojiRadius));
      }

      // ğŸ¥ºæç”»
      ctx.save();
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.font = fontSize + "px serif";
      ctx.fillText(emoji, x, y);
      ctx.restore();

      // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆå·¦ä¸Šï¼‰
      ctx.save();
      ctx.textAlign = "left";
      ctx.textBaseline = "top";
      ctx.font = "20px sans-serif";
      ctx.fillText("ğŸ¥º " + puyuyu, 8, 8);
      ctx.restore();

      // ã‚¿ãƒƒãƒ—è³¼å…¥ãƒœã‚¿ãƒ³ï¼ˆå³ä¸‹ï¼‰
      ctx.save();
      ctx.textAlign = "right";
      ctx.textBaseline = "bottom";
      ctx.font = "18px sans-serif";
      ctx.fillText("ã‚¿ãƒƒãƒ—(Lv" + tapLevel + ") ğŸ¥º" + tapCost, canvas.width - 10, canvas.height - 10);
      ctx.restore();

      requestAnimationFrame(update);
    }

    update();
  </script>
</body>
</html>
